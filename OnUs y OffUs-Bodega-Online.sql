SELECT
    CONVERT(VARCHAR(7), FECHA_CONSUMO, 120) AS MES,
    CLAVE_COMERCIO,
    COUNT(DISTINCT NUM_CUENTA) AS CUENTAS_UNICAS,
    SUM(IMP_DESTINO) AS SUMA_IMP_DESTINO,
    COUNT(IMP_DESTINO) AS CONTAR_IMP_DESTINO
FROM PROSA_510
WHERE 
    FECHA_CONSUMO >= '2022-01-01 00:00:00.000' AND 
    FECHA_CONSUMO <= '2022-09-30 00:00:00.000' AND
    TIPO_TRANSACCION = '01' AND
    LEFT(NUM_CUENTA, 6) IN ('506371', '481283') AND
    RFC_COMERCIO = 'NWM 9709244W4' AND (
        CLAVE_COMERCIO LIKE '%4163436' OR
        CLAVE_COMERCIO LIKE '%4163435' OR
        CLAVE_COMERCIO LIKE '%4302584' OR
        CLAVE_COMERCIO LIKE '%8435228' OR
        CLAVE_COMERCIO LIKE '%8435228' OR
        CLAVE_COMERCIO LIKE '%4392592' OR
        CLAVE_COMERCIO LIKE '%4194989' OR
        CLAVE_COMERCIO LIKE '%4044712' OR
        CLAVE_COMERCIO LIKE '%4180118' OR
        CLAVE_COMERCIO LIKE '%8434689' OR
        CLAVE_COMERCIO LIKE '%4302592'
    )
GROUP BY
    CONVERT(VARCHAR(7), FECHA_CONSUMO, 120),
    CLAVE_COMERCIO
ORDER BY MES, CLAVE_COMERCIO;

